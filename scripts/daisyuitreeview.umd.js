(function(f,u){typeof exports=="object"&&typeof module<"u"?module.exports=u():typeof define=="function"&&define.amd?define(u):(f=typeof globalThis<"u"?globalThis:f||self,f.DaisyUITreeView=u())})(this,function(){"use strict";const f={data:[],expandIconUrl:"./assets/chevron-down-solid.svg",collapseIconUrl:"./assets/chevron-right-solid.svg",blankIconUrl:"./assets/blank.svg",hasCheckbox:!1,treeName:"treeView",multipleSelect:!1,multipleCheck:!1,iconHeight:"16px",iconWidth:"16px",inlineEdit:!1,dragNDrop:!1,itemColor:"primary",itemActiveColor:"",itemFocusColor:"",itemHoverColor:"",UseLocalstorage:!0,replace:!1,checkBoxSize:"md",textBoxSize:"sm",checkBoxActiveColor:"",checkBoxActiveBorderColor:""};class u{constructor(t,s={}){if(this.element=t,this.settings={...f,...s},this.treeName=this._normalizeId(this.settings.treeName),this.tree=[],this.nodeMap=new Map,this._checkedNodes=new Set,this._selectedNodes=new Set,this._visibleNodes=new Set,this._activeColor=this.fixColor("checked:bg",this.settings.checkBoxActiveColor),this._activeBorderColor=this.fixColor("checked:border",this.settings.checkBoxActiveBorderColor),this._inputColorClass=`input-${this.settings.itemColor}`,this._checkColorClass=`checkbox-${this.settings.itemColor}`,this._inputSizeClass=`input-${this.settings.textBoxSize}`,this._checkSizeClass=`checkbox-${this.settings.checkBoxSize}`,this.settings.data){let i=Array.isArray(this.settings.data)?JSON.parse(JSON.stringify(this.settings.data)):[];this.tree=i,delete this.settings.data}this._refresh(),this.settings.dragNDrop&&this._enableDragAndDrop(),this.element.addEventListener("blur",this._onBlur.bind(this),!0),this.element.addEventListener("keydown",this._onKeydown.bind(this)),this.element.addEventListener("click",i=>this._onClick(i));const e=document.createElement("style");e.innerHTML=".xsummary::after { display: none !important; }",document.head.appendChild(e)}_toggleVisibility(t,s){t&&(s?t.classList.remove("hidden"):t.classList.add("hidden"))}_getElementById(t){return document.getElementById(t)}_onCheckboxChange(t,s){if(!this.nodeExists(t))return;const e=this.findNode(t);this.checkNode(t,s),this._dispatchEvent("nodeChecked",{node:e,checked:s})}fixColor(t,s){if(t=t==null?"":String(t),s=s==null?"":String(s),!t||!s)return"";s.startsWith("#")&&(s=`[${s}]`),(t==="btn"||t==="badge")&&(t="bg");const e=`${t}-${s}`;return e.endsWith("-")?"":e}collapseAll(){const t=s=>{for(const e of s)this._collapseNode(e.nodeId),e.nodes&&t(e.nodes)};t(this.tree)}expandAll(){const t=s=>{for(const e of s)this._expandNode(e.nodeId),e.nodes&&t(e.nodes)};t(this.tree)}_refresh(){const t=document.createDocumentFragment();this._initializeData({nodes:this.tree}),this._build(t,this.tree),this.element.innerHTML="",this.element.appendChild(t)}_initializeData(t){if(t.nodes)for(const s of t.nodes)s.nodeId=this._normalizeId(s.nodeId),s.parentId=this._normalizeId(s.parentId),this._visibleNodes.add(s.nodeId),this.nodeMap.set(s.nodeId,s),s.nodes&&this._initializeData({nodes:s.nodes})}_build(t,s){for(const e of s){const i=document.createElement("li");if(i.id=`${this.treeName}-${e.nodeId}`,i.classList.add("list-item"),i.dataset.id=e.nodeId,i.setAttribute("role","treeitem"),i.setAttribute("aria-expanded",e.expanded||!1),this.settings.dragNDrop&&i.setAttribute("draggable","true"),i.setAttribute("aria-selected",this._selectedNodes.has(e.nodeId)||!1),this.settings.itemColor!==""&&i.classList.add(this.settings.itemColor),this.settings.itemActiveColor!==""&&i.classList.add(this.settings.itemActiveColor),this.settings.itemFocusColor!==""&&i.classList.add(this.settings.itemFocusColor),this.settings.itemHoverColor!==""&&i.classList.add(this.settings.itemHoverColor),this._visibleNodes.has(e.nodeId)||this._toggleVisibility(i,!1),this._selectedNodes.has(e.nodeId)&&i.classList.add("menu-active"),e.disabled&&(i.setAttribute("aria-disabled","true"),i.classList.add("menu-disabled")),e.nodes&&e.nodes.length>0){const n=document.createElement("details");n.id=`${this.treeName}-${e.nodeId}-details`,n.dataset.id=e.nodeId,n.classList.add("xdetails"),i.classList.add("xdetails"),e.expanded&&n.setAttribute("open","");const d=document.createElement("summary");d.id=`${this.treeName}-${e.nodeId}-summary`,d.dataset.id=e.nodeId,d.classList.add("xsummary");const o=document.createElement("div");o.id=`${this.treeName}-${e.nodeId}-div`,o.dataset.id=e.nodeId,o.classList.add("flex","items-center","gap-3","w-full","xdiv");const a=document.createElement("svg-renderer");if(a.setAttribute("replace",!1),a.id=`${this.treeName}-${e.nodeId}-expandicon`,a.dataset.id=e.nodeId,a.setAttribute("use-localstorage",this.settings.UseLocalstorage),a.dataset.src=e.expanded?this.settings.expandIconUrl:this.settings.collapseIconUrl,a.setAttribute("style","pointer-events:none; min-height:"+this.settings.iconHeight+"; min-width:"+this.settings.iconWidth+";"),a.setAttribute("fill","currentColor"),a.setAttribute("data-js","enabled"),a.setAttribute("width",this.settings.iconWidth),a.setAttribute("height",this.settings.iconHeight),o.appendChild(a),e.iconUrl){const h=document.createElement("svg-renderer");h.setAttribute("replace",!0),h.id=`${this.treeName}-${e.nodeId}-icon`,h.setAttribute("use-localstorage",this.settings.UseLocalstorage),h.dataset.src=e.iconUrl,h.dataset.id=e.nodeId,h.setAttribute("style","pointer-events:none; min-height:"+this.settings.iconHeight+"; min-width:"+this.settings.iconWidth+";"),h.setAttribute("fill","currentColor"),h.setAttribute("data-js","enabled"),h.setAttribute("width",this.settings.iconWidth),h.setAttribute("height",this.settings.iconHeight),o.appendChild(h)}if(this.settings.hasCheckbox){const h=document.createElement("input");h.id=`${this.treeName}-${e.nodeId}-check`,h.type="checkbox",h.classList.add("checkbox"),this._checkColorClass!==""&&h.classList.add(this._checkColorClass),this._activeColor!==""&&h.classList.add(this._activeColor),this._activeBorderColor!==""&&h.classList.add(this._activeBorderColor),this._checkSizeClass!==""&&h.classList.add(this._checkSizeClass),h.dataset.id=e.nodeId,h.checked=this._checkedNodes.has(e.nodeId),o.appendChild(h)}const r=document.createElement("input");r.id=`${this.treeName}-${e.nodeId}-input`,r.type="text",r.value=e.text,r.classList.add("input","input-ghost","hidden","xinput","w-full"),this._inputColorClass!==""&&r.classList.add(this._inputColorClass),this._inputSizeClass!==""&&r.classList.add(this._inputSizeClass),r.dataset.id=e.nodeId,o.appendChild(r);const l=document.createElement("span");l.id=`${this.treeName}-${e.nodeId}-text`,l.textContent=e.text,l.dataset.id=e.nodeId,l.classList.add("xspan"),o.appendChild(l),d.appendChild(o),n.appendChild(d);const c=document.createElement("ul");c.id=`${this.treeName}-${e.nodeId}-ul`,c.dataset.id=e.nodeId,this._build(c,e.nodes),n.appendChild(c),i.appendChild(n)}else{const n=document.createElement("div");n.id=`${this.treeName}-${e.nodeId}-anchor`,n.dataset.id=e.nodeId,n.classList.add("xanchor","flex","items-center","gap-3","w-full"),this.settings.itemColor!==""&&n.classList.add(this.settings.itemColor),this.settings.itemActiveColor!==""&&n.classList.add(this.settings.itemActiveColor),this.settings.itemFocusColor!==""&&n.classList.add(this.settings.itemFocusColor),this.settings.itemHoverColor!==""&&n.classList.add(this.settings.itemHoverColor),e.href&&n.setAttribute("href",e.href);const d=document.createElement("svg-renderer");if(d.setAttribute("replace",this.settings.replace),d.id=`${this.treeName}-${e.nodeId}-blankicon`,d.dataset.id=e.nodeId,d.setAttribute("use-localstorage",this.settings.UseLocalstorage),d.dataset.src=this.settings.blankIconUrl,d.setAttribute("style","pointer-events:none; min-height:"+this.settings.iconHeight+"; min-width:"+this.settings.iconWidth+";"),d.setAttribute("fill","currentColor"),d.setAttribute("data-js","enabled"),d.setAttribute("width",this.settings.iconWidth),d.setAttribute("height",this.settings.iconHeight),n.appendChild(d),e.iconUrl){const r=document.createElement("svg-renderer");r.setAttribute("replace",!0),r.setAttribute("use-localstorage",this.settings.UseLocalstorage),r.dataset.src=e.iconUrl,r.dataset.id=e.nodeId,r.id=`${this.treeName}-${e.nodeId}-icon`,r.setAttribute("style","pointer-events:none; min-height:"+this.settings.iconHeight+"; min-width:"+this.settings.iconWidth+";"),r.setAttribute("fill","currentColor"),r.setAttribute("data-js","enabled"),r.setAttribute("width",this.settings.iconWidth),r.setAttribute("height",this.settings.iconHeight),n.appendChild(r)}if(this.settings.hasCheckbox){const r=document.createElement("input");r.id=`${this.treeName}-${e.nodeId}-check`,r.type="checkbox",r.classList.add("checkbox"),r.dataset.id=e.nodeId,r.checked=this._checkedNodes.has(e.nodeId),this._checkColorClass!==""&&r.classList.add(this._checkColorClass),this._activeColor!==""&&r.classList.add(this._activeColor),this._activeBorderColor!==""&&r.classList.add(this._activeBorderColor),this._checkSizeClass!==""&&r.classList.add(this._checkSizeClass),n.appendChild(r)}const o=document.createElement("input");o.id=`${this.treeName}-${e.nodeId}-input`,o.type="text",o.value=e.text,o.classList.add("input","input-ghost","hidden","w-full","xinput"),this._inputColorClass!==""&&o.classList.add(this._inputColorClass),this._inputSizeClass!==""&&o.classList.add(this._inputSizeClass),o.dataset.id=e.nodeId,n.appendChild(o);const a=document.createElement("span");a.id=`${this.treeName}-${e.nodeId}-text`,a.textContent=e.text,a.dataset.id=e.nodeId,a.classList.add("xspan"),n.appendChild(a),i.appendChild(n)}t.appendChild(i)}}_onClick(t){const s=t.target.closest(".checkbox");if(s){t.stopPropagation();const d=this._normalizeId(s.dataset.id);if(this.nodeExists(d)){const o=s.checked;this._onCheckboxChange(d,o)}return}const e=t.target.closest(".xsummary");if(e){t.stopPropagation();const d=this._normalizeId(e.dataset.id);if(!this.nodeExists(d))return;const o=this.findNode(d);let r=this._getElementById(`${this.treeName}-${d}-details`).hasAttribute("open");r=!r,o.expanded=r;const l=r?"nodeExpanded":"nodeCollapsed",c=this._getElementById(`${this.treeName}-${d}-expandicon`);c&&(r?c.setAttribute("data-src",this.settings.expandIconUrl):c.setAttribute("data-src",this.settings.collapseIconUrl)),this._dispatchEvent(l,{node:o});return}const i=t.target.closest(".xspan");if(i){t.stopPropagation();const d=this._normalizeId(i.dataset.id);if(!this.nodeExists(d))return;const o=this.findNode(d);if(this.settings.inlineEdit&&t.target.id===`${this.treeName}-${d}-text`){this._enableInlineEdit(d);return}this._dispatchEvent("nodeClick",{node:o});return}const n=t.target.closest(".xanchor");if(n){t.stopPropagation();const d=this._normalizeId(n.dataset.id);if(!this.nodeExists(d))return;const o=this.findNode(d);if(this.settings.inlineEdit){this._enableInlineEdit(d);return}this._dispatchEvent("nodeClick",{node:o});return}}_enableDragAndDrop(){this.element.addEventListener("dragend",t=>{const s=this.element.querySelector(".drag-over");s&&s.classList.remove("drag-over")}),this.element.addEventListener("dragstart",t=>{const s=t.target.closest(".list-item");s&&t.dataTransfer.setData("id",s.dataset.id)}),this.element.addEventListener("dragover",t=>{t.preventDefault();const s=t.target.closest(".list-item");s&&s.classList.add("drag-over")}),this.element.addEventListener("dragleave",t=>{const s=t.target.closest(".list-item");s&&s.classList.remove("drag-over")}),this.element.addEventListener("drop",t=>{t.preventDefault();const s=t.target.closest(".list-item");if(!s)return;const e=t.dataTransfer.getData("id"),i=s.dataset.id;if(e===i)return;const n=this.findNode(e),d=this.findNode(i);let o=d;for(;o;){if(o.nodeId===e)return;o=this.findNode(o.parentId)}n&&d&&(this._dispatchEvent("nodeDragStart",{draggedNode:n}),this._dispatchEvent("nodeDrop",{draggedNode:n,targetNode:d}),this.removeNode(e),this.addNode(i,n.nodeId,n.iconUrl,n.text,n.href,n.hasCheckbox),this._refresh())})}_normalizeId(t){return(t??"").toString().trim().toLowerCase()}_cstr(t){return(t??"").toString()}nodeExists(t){const s=this._normalizeId(t);return s===""?!1:this.nodeMap.has(s)}findNode(t){const s=this._normalizeId(t);return s===""?null:this.nodeMap.get(s)||null}addNode(t,s,e="",i,n=""){if(t=this._normalizeId(t),s=this._normalizeId(s),e=this._cstr(e),i=this._cstr(i),n=this._cstr(n),s===""||this.nodeExists(s))return;e===""&&(e=this.settings.blankIconUrl);const d=this.settings.hasCheckbox||!1,o={nodeId:s,parentId:t,iconUrl:e,text:i,href:n,hasCheckbox:d};if(t==="")this.tree.push(o);else{const a=this.findNode(t);a&&(a.nodes=a.nodes||[],a.nodes.push(o),this.nodeMap.set(t,a))}this.nodeMap.set(s,o),this._visibleNodes.add(s)}addNodeBefore(t,s,e="",i,n=""){if(t=this._normalizeId(t),s=this._normalizeId(s),e=this._cstr(e),i=this._cstr(i),n=this._cstr(n),!this.nodeExists(t)||this.nodeExists(s))return;e===""&&(e=this.settings.blankIconUrl);const o=this.findNode(t).parentId,a={nodeId:s,parentId:o,iconUrl:e,text:i,href:n,hasCheckbox:this.settings.hasCheckbox||!1};if(o){const r=this.findNode(o);if(r&&r.nodes){const l=r.nodes.findIndex(c=>c.nodeId===t);l!==-1&&r.nodes.splice(l,0,a)}}else{const r=this.tree.findIndex(l=>l.nodeId===t);r!==-1&&this.tree.splice(r,0,a)}this.nodeMap.set(s,a),this._visibleNodes.add(s),this._refresh()}addNodeAfter(t,s,e="",i,n=""){if(t=this._normalizeId(t),s=this._normalizeId(s),e=this._cstr(e),i=this._cstr(i),n=this._cstr(n),!this.nodeExists(t)||this.nodeExists(s))return;e===""&&(e=this.settings.blankIconUrl);const o=this.findNode(t).parentId,a={nodeId:s,parentId:o,iconUrl:e,text:i,href:n,hasCheckbox:this.settings.hasCheckbox||!1};if(o){const r=this.findNode(o);if(r&&r.nodes){const l=r.nodes.findIndex(c=>c.nodeId===t);l!==-1&&r.nodes.splice(l+1,0,a)}}else{const r=this.tree.findIndex(l=>l.nodeId===t);r!==-1&&this.tree.splice(r+1,0,a)}this.nodeMap.set(s,a),this._visibleNodes.add(s),this._refresh()}findNodeRecursive(t,s){for(const e of t){if(e.nodeId===s)return e;if(e.nodes&&e.nodes.length>0){const i=findNodeRecursive(e.nodes,s);if(i)return i}}return null}hideNode(t){if(!this.nodeExists(t))return;const s=this.findNode(t),e=i=>{if(!i)return;this._visibleNodes.delete(i.nodeId),i.visible=!1;const n=this._getElementById(`${this.treeName}-${i.nodeId}`);n&&this._toggleVisibility(n,!1),i.nodes&&i.nodes.forEach(d=>e(d))};e(s)}showNode(t){if(!this.nodeExists(t))return;const s=this.findNode(t),e=i=>{if(!i)return;this._visibleNodes.add(i.nodeId),i.visible=!0;const n=this._getElementById(`${this.treeName}-${i.nodeId}`);n&&this._toggleVisibility(n,!0),i.nodes&&i.nodes.forEach(d=>e(d))};e(s)}checkNode(t,s){if(!this.nodeExists(t))return;const e=this.findNode(t),i=(n,d)=>{if(!n)return;d?this._checkedNodes.add(n.nodeId):this._checkedNodes.delete(n.nodeId),n.checked=d;const o=this._getElementById(`${this.treeName}-${n.nodeId}-check`);o&&(o.checked=d),n.nodes&&n.nodes.forEach(a=>i(a,d))};i(e,s)}expandNode(t,s){s?this._expandNode(t):this._collapseNode(t)}removeNode(t){if(t=this._normalizeId(t),!this.nodeExists(t))return;const s=this.findNode(t);if(s.parentId){const i=this.findNode(s.parentId);i&&i.nodes&&(i.nodes=i.nodes.filter(n=>n.nodeId!==t))}else this.tree=this.tree.filter(i=>i.nodeId!==t);this.nodeMap.delete(t);const e=this._getElementById(`${this.treeName}-${t}`);e&&e.remove(),this._visibleNodes.delete(t),this._selectedNodes.delete(t),this._checkedNodes.delete(t)}_expandNode(t){if(!this.nodeExists(t))return;const s=this.findNode(t);s.expanded=!0;const e=this._getElementById(`${this.treeName}-${s.nodeId}-details`);e&&e.setAttribute("open","")}_collapseNode(t){if(!this.nodeExists(t))return;const s=this.findNode(t);s.expanded=!1;const e=this._getElementById(`${this.treeName}-${s.nodeId}-details`);e&&e.removeAttribute("open")}enableNode(t,s){s?this._enableNode(t):this._disableNode(t)}_enableNode(t){if(!this.nodeExists(t))return;const s=this.findNode(t),e=i=>{if(!i)return;i.disabled=!1;const n=this._getElementById(`${this.treeName}-${i.nodeId}`);n&&n.classList.remove("menu-disabled"),i.nodes&&i.nodes.forEach(d=>e(d))};e(s)}_disableNode(t){if(!this.nodeExists(t))return;const s=this.findNode(t),e=i=>{if(!i)return;i.disabled=!0;const n=this._getElementById(`${this.treeName}-${i.nodeId}`);n&&n.classList.add("menu-disabled"),i.nodes&&i.nodes.forEach(d=>e(d))};e(s)}clear(){this.nodeMap.clear(),this.tree=[],this._checkedNodes.clear(),this._selectedNodes.clear(),this._visibleNodes.clear()}getChildren(t){if(!this.nodeExists(t))return[];const s=this.findNode(t);return Array.isArray(s.nodes)?[...s.nodes]:[]}removeChildren(t){if(!this.nodeExists(t))return;const s=this.findNode(t);s.nodes&&(s.nodes.forEach(e=>this._checkedNodes.delete(e.nodeId)),s.nodes.forEach(e=>this._selectedNodes.delete(e.nodeId)),s.nodes.forEach(e=>this._visibleNodes.delete(e.nodeId)),s.nodes.forEach(e=>this.removeNode(e.nodeId))),s.nodes=[]}updateNode(t,s,e,i=""){if(t=this._normalizeId(t),s=this._cstr(s),e=this._cstr(e),i=this._cstr(i),t===""||!this.nodeExists(t))return;s===""&&(s=this.settings.blankIconUrl);const n=this.findNode(t);n.iconUrl=s,n.text=e,n.href=i;const d=this._getElementById(`${this.treeName}-${n.nodeId}-text`);d&&(d.textContent=e);const o=this._getElementById(`${this.treeName}-${n.nodeId}-input`);o&&(o.value=e);const a=this._getElementById(`${this.treeName}-${n.nodeId}-icon`);a&&(a.dataset.src=s)}selectNode(t,s){if(!this.nodeExists(t))return;const e=this.findNode(t),i=(n,d)=>{if(!n)return;d?this._selectedNodes.add(n.nodeId):this._selectedNodes.delete(n.nodeId),n.selected=d;const o=this._getElementById(`${this.treeName}-${n.nodeId}`);o&&(d?o.classList.add("menu-active"):o.classList.remove("menu-active")),n.nodes&&n.nodes.forEach(a=>i(a,d))};i(e,s)}clearSelected(){this._selectedNodes.forEach(t=>this.selectNode(t.nodeId,!1)),this._selectedNodes.clear()}clearChecked(){this._checkedNodes.forEach(t=>this.checkNode(t.nodeId,!1)),this._checkedNodes.clear()}selectNodes(t){this._selectedNodes.forEach(e=>this.selectNode(e.nodeId,!1)),new Set(t.map(e=>this._normalizeId(e))).forEach(e=>this.selectNode(e,!0))}getSelectedNode(t=!1){const s=this.element.querySelector(".menu-active");if(!s)return null;const e=this._normalizeId(s.dataset.id),i=this.findNode(e);return!i||!t?i:{...i,nodes:i.nodes??[]}}getSelectedNodes(){return Array.from(this._selectedNodes)}getCheckedNodes(){return Array.from(this._checkedNodes)}checkNodes(t){this._checkedNodes.forEach(e=>this.checkNode(e.nodeId,!1));const s=new Set(t.map(e=>this._normalizeId(e)));s.forEach(e=>this.checkNode(e,!0)),this._dispatchEvent("nodesChecked",{nodeIds:s})}enableInlineEditing(t){this._enableInlineEdit(t)}refresh(){this._refresh()}nodeMoveLeft(t){if(!this.nodeExists(t))return;const s=this.findNode(t),e=this.findNode(s.parentId);if(e){if(s.parentId=e.parentId,e.nodes&&(e.nodes=e.nodes.filter(i=>i.nodeId!==t)),s.parentId){const i=this.findNode(s.parentId);i&&(i.nodes=i.nodes||[],i.nodes.push(s))}else this.tree.push(s);this._refresh()}}nodeMoveRight(t){if(!this.nodeExists(t))return;const s=this.findNode(t),e=this.findNode(s.parentId);if(e&&e.nodes){const i=e.nodes.findIndex(n=>n.nodeId===t);if(i>0){const n=e.nodes[i-1];n.nodes=n.nodes||[],n.nodes.push(s),s.parentId=n.nodeId,e.nodes.splice(i,1),this._refresh()}else console.warn("Cannot move the first child node to the right.")}else if(s.parentId)console.warn("Cannot move node to the right as it has no valid parent or sibling.");else{const i=this.tree.findIndex(n=>n.nodeId===t);if(i>0){const n=this.tree[i-1];n.nodes=n.nodes||[],n.nodes.push(s),s.parentId=n.nodeId,this.tree.splice(i,1),this._refresh()}else console.warn("Cannot move the first root node to the right.")}}nodeMoveUp(t){if(!this.nodeExists(t))return;const s=this.findNode(t),e=this.findNode(s.parentId);if(e&&e.nodes){const i=e.nodes.findIndex(n=>n.nodeId===t);i>0&&([e.nodes[i-1],e.nodes[i]]=[e.nodes[i],e.nodes[i-1]],this._refresh())}else if(!s.parentId){const i=this.tree.findIndex(n=>n.nodeId===t);i>0&&([this.tree[i-1],this.tree[i]]=[this.tree[i],this.tree[i-1]],this._refresh())}}nodeMoveDown(t){if(!this.nodeExists(t))return;const s=this.findNode(t),e=this.findNode(s.parentId);if(e&&e.nodes){const i=e.nodes.findIndex(n=>n.nodeId===t);i<e.nodes.length-1&&([e.nodes[i],e.nodes[i+1]]=[e.nodes[i+1],e.nodes[i]],this._refresh())}else if(!s.parentId){const i=this.tree.findIndex(n=>n.nodeId===t);i<this.tree.length-1&&([this.tree[i],this.tree[i+1]]=[this.tree[i+1],this.tree[i]],this._refresh())}}_dispatchEvent(t,s){const e=new CustomEvent(t,{detail:s});this.element.dispatchEvent(e)}_onBlur(t){const s=t.target.closest("input.xinput");if(!s)return;const e=this._normalizeId(s.dataset.id),i=this.findNode(e);if(!i)return;const n=this._getElementById(`${this.treeName}-${e}-text`);if(!n)return;const d=i.text;if(s.value.trim()===""){this._toggleVisibility(s,!1),this._toggleVisibility(n,!0),this._dispatchEvent("nodeEditCancelled",{node:i});return}if(s.value.trim()===d){this._toggleVisibility(s,!1),this._toggleVisibility(n,!0),this._dispatchEvent("nodeEditCancelled",{node:i});return}i.text=s.value.trim(),n.textContent=s.value.trim(),s.value=s.value.trim(),this._toggleVisibility(s,!1),this._toggleVisibility(n,!0),this._dispatchEvent("nodeEdited",{node:i})}_onKeydown(t){const s=t.target.closest("input.xinput");if(!s)return;const e=this._normalizeId(s.dataset.id),i=this.findNode(e);if(!i)return;const n=this._getElementById(`${this.treeName}-${e}-text`);if(!n)return;const d=i.text;t.key==="Enter"?s.blur():t.key==="Escape"&&(i.text=d,n.textContent=d,s.value=d,s.blur())}_enableInlineEdit(t){const s=this.findNode(t);if(!s)return;const e=this._getElementById(`${this.treeName}-${t}-text`),i=this._getElementById(`${this.treeName}-${t}-input`);!e||!i||(i.value=s.text,this._toggleVisibility(e,!1),this._toggleVisibility(i,!0),i.focus())}getTree(){return this.tree}flattenTree(){const t=s=>s.reduce((e,i)=>(e.push(i),i.nodes&&i.nodes.length>0&&(e=e.concat(t(i.nodes))),e),[]);return t(this.tree)}}return u});
