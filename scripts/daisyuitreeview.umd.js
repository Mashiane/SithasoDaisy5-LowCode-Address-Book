(function(f,u){typeof exports=="object"&&typeof module<"u"?module.exports=u():typeof define=="function"&&define.amd?define(u):(f=typeof globalThis<"u"?globalThis:f||self,f.DaisyUITreeView=u())})(this,function(){"use strict";const f={data:[],expandIconUrl:"./assets/chevron-down-solid.svg",collapseIconUrl:"./assets/chevron-right-solid.svg",blankIconUrl:"./assets/blank.svg",hasCheckbox:!1,treeName:"treeView",multipleSelect:!1,multipleCheck:!1,iconHeight:"16px",iconWidth:"16px",inlineEdit:!1,dragNDrop:!1,itemColor:"primary",itemActiveColor:"",itemFocusColor:"",itemHoverColor:"",UseLocalstorage:!0,replace:!1,checkBoxSize:"md",textBoxSize:"sm",checkBoxActiveColor:"",checkBoxActiveBorderColor:""};class u{constructor(e,s={}){if(this.element=e,this._doc=e&&e.ownerDocument||document,this.settings={...f,...s},this.treeName=this._normalizeId(this.settings.treeName),this.tree=[],this.nodeMap=new Map,this._checkedNodes=new Set,this._selectedNodes=new Set,this._visibleNodes=new Set,this._activeColor=this.fixColor("checked:bg",this.settings.checkBoxActiveColor),this._activeBorderColor=this.fixColor("checked:border",this.settings.checkBoxActiveBorderColor),this._inputColorClass=`input-${this.settings.itemColor}`,this._checkColorClass=`checkbox-${this.settings.itemColor}`,this._inputSizeClass=`input-${this.settings.textBoxSize}`,this._checkSizeClass=`checkbox-${this.settings.checkBoxSize}`,this.settings.data){let t=Array.isArray(this.settings.data)?JSON.parse(JSON.stringify(this.settings.data)):[];this.tree=t,delete this.settings.data}this._refresh(),this.settings.dragNDrop&&this._enableDragAndDrop(),this.element.addEventListener("blur",this._onBlur.bind(this),!0),this.element.addEventListener("keydown",this._onKeydown.bind(this)),this.element.addEventListener("click",t=>this._onClick(t));const i=document.createElement("style");i.innerHTML=".xsummary::after { display: none !important; }",document.head.appendChild(i)}_toggleVisibility(e,s){e&&(s?e.classList.remove("hidden"):e.classList.add("hidden"))}_getElementById(e){return document.getElementById(e)}_onCheckboxChange(e,s){if(!this.nodeExists(e))return;const i=this.findNode(e);this.checkNode(e,s),this._dispatchEvent("nodeChecked",{node:i,checked:s})}fixColor(e,s){if(e=e==null?"":String(e),s=s==null?"":String(s),!e||!s)return"";s.startsWith("#")&&(s=`[${s}]`),(e==="btn"||e==="badge")&&(e="bg");const i=`${e}-${s}`;return i.endsWith("-")?"":i}collapseAll(){const e=s=>{for(const i of s)this._collapseNode(i.nodeId),i.nodes&&e(i.nodes)};e(this.tree)}expandAll(){const e=s=>{for(const i of s)this._expandNode(i.nodeId),i.nodes&&e(i.nodes)};e(this.tree)}_refresh(){const e=this._doc.createDocumentFragment();this._initializeData({nodes:this.tree}),this._build(e,this.tree),this.element.innerHTML="",this.element.appendChild(e)}_initializeData(e){if(e.nodes)for(const s of e.nodes)s.nodeId=this._normalizeId(s.nodeId),s.parentId=this._normalizeId(s.parentId),this._visibleNodes.add(s.nodeId),this.nodeMap.set(s.nodeId,s),s.nodes&&this._initializeData({nodes:s.nodes})}_build(e,s){const i=this._doc||document;for(const t of s){const n=i.createElement("li");if(n.id=`${this.treeName}-${t.nodeId}`,n.classList.add("list-item"),n.dataset.id=t.nodeId,n.setAttribute("role","treeitem"),n.setAttribute("aria-expanded",t.expanded||!1),this.settings.dragNDrop&&n.setAttribute("draggable","true"),n.setAttribute("aria-selected",this._selectedNodes.has(t.nodeId)||!1),this.settings.itemColor!==""&&n.classList.add(this.settings.itemColor),this.settings.itemActiveColor!==""&&n.classList.add(this.settings.itemActiveColor),this.settings.itemFocusColor!==""&&n.classList.add(this.settings.itemFocusColor),this.settings.itemHoverColor!==""&&n.classList.add(this.settings.itemHoverColor),this._visibleNodes.has(t.nodeId)||this._toggleVisibility(n,!1),this._selectedNodes.has(t.nodeId)&&n.classList.add("menu-active"),t.disabled&&(n.setAttribute("aria-disabled","true"),n.classList.add("menu-disabled")),t.nodes&&t.nodes.length>0){const d=i.createElement("details");d.id=`${this.treeName}-${t.nodeId}-details`,d.dataset.id=t.nodeId,d.classList.add("xdetails"),n.classList.add("xdetails"),t.expanded&&d.setAttribute("open","");const o=i.createElement("summary");o.id=`${this.treeName}-${t.nodeId}-summary`,o.dataset.id=t.nodeId,o.classList.add("xsummary");const a=i.createElement("div");a.id=`${this.treeName}-${t.nodeId}-div`,a.dataset.id=t.nodeId,a.classList.add("flex","items-center","gap-3","w-full","xdiv");const h=i.createElement("svg-renderer");if(h.setAttribute("replace",!1),h.id=`${this.treeName}-${t.nodeId}-expandicon`,h.dataset.id=t.nodeId,h.setAttribute("use-localstorage",this.settings.UseLocalstorage),h.dataset.src=t.expanded?this.settings.expandIconUrl:this.settings.collapseIconUrl,h.setAttribute("style","pointer-events:none; min-height:"+this.settings.iconHeight+"; min-width:"+this.settings.iconWidth+";"),h.setAttribute("fill","currentColor"),h.setAttribute("data-js","enabled"),h.setAttribute("width",this.settings.iconWidth),h.setAttribute("height",this.settings.iconHeight),a.appendChild(h),t.iconUrl){const l=i.createElement("svg-renderer");l.setAttribute("replace",!0),l.id=`${this.treeName}-${t.nodeId}-icon`,l.setAttribute("use-localstorage",this.settings.UseLocalstorage),l.dataset.src=t.iconUrl,l.dataset.id=t.nodeId,l.setAttribute("style","pointer-events:none; min-height:"+this.settings.iconHeight+"; min-width:"+this.settings.iconWidth+";"),l.setAttribute("fill","currentColor"),l.setAttribute("data-js","enabled"),l.setAttribute("width",this.settings.iconWidth),l.setAttribute("height",this.settings.iconHeight),a.appendChild(l)}if(this.settings.hasCheckbox){const l=i.createElement("input");l.id=`${this.treeName}-${t.nodeId}-check`,l.type="checkbox",l.classList.add("checkbox"),this._checkColorClass!==""&&l.classList.add(this._checkColorClass),this._activeColor!==""&&l.classList.add(this._activeColor),this._activeBorderColor!==""&&l.classList.add(this._activeBorderColor),this._checkSizeClass!==""&&l.classList.add(this._checkSizeClass),l.dataset.id=t.nodeId,l.checked=this._checkedNodes.has(t.nodeId),a.appendChild(l)}const r=i.createElement("input");r.id=`${this.treeName}-${t.nodeId}-input`,r.type="text",r.value=t.text,r.classList.add("input","input-ghost","hidden","xinput","w-full"),this._inputColorClass!==""&&r.classList.add(this._inputColorClass),this._inputSizeClass!==""&&r.classList.add(this._inputSizeClass),r.dataset.id=t.nodeId,a.appendChild(r);const c=i.createElement("span");c.id=`${this.treeName}-${t.nodeId}-text`,c.textContent=t.text,c.dataset.id=t.nodeId,c.classList.add("xspan"),a.appendChild(c),o.appendChild(a),d.appendChild(o);const m=i.createElement("ul");m.id=`${this.treeName}-${t.nodeId}-ul`,m.dataset.id=t.nodeId,this._build(m,t.nodes),d.appendChild(m),n.appendChild(d)}else{const d=i.createElement("div");d.id=`${this.treeName}-${t.nodeId}-anchor`,d.dataset.id=t.nodeId,d.classList.add("xanchor","flex","items-center","gap-3","w-full"),this.settings.itemColor!==""&&d.classList.add(this.settings.itemColor),this.settings.itemActiveColor!==""&&d.classList.add(this.settings.itemActiveColor),this.settings.itemFocusColor!==""&&d.classList.add(this.settings.itemFocusColor),this.settings.itemHoverColor!==""&&d.classList.add(this.settings.itemHoverColor),t.href&&d.setAttribute("href",t.href);const o=i.createElement("svg-renderer");if(o.setAttribute("replace",this.settings.replace),o.id=`${this.treeName}-${t.nodeId}-blankicon`,o.dataset.id=t.nodeId,o.setAttribute("use-localstorage",this.settings.UseLocalstorage),o.dataset.src=this.settings.blankIconUrl,o.setAttribute("style","pointer-events:none; min-height:"+this.settings.iconHeight+"; min-width:"+this.settings.iconWidth+";"),o.setAttribute("fill","currentColor"),o.setAttribute("data-js","enabled"),o.setAttribute("width",this.settings.iconWidth),o.setAttribute("height",this.settings.iconHeight),d.appendChild(o),t.iconUrl){const r=i.createElement("svg-renderer");r.setAttribute("replace",!0),r.setAttribute("use-localstorage",this.settings.UseLocalstorage),r.dataset.src=t.iconUrl,r.dataset.id=t.nodeId,r.id=`${this.treeName}-${t.nodeId}-icon`,r.setAttribute("style","pointer-events:none; min-height:"+this.settings.iconHeight+"; min-width:"+this.settings.iconWidth+";"),r.setAttribute("fill","currentColor"),r.setAttribute("data-js","enabled"),r.setAttribute("width",this.settings.iconWidth),r.setAttribute("height",this.settings.iconHeight),d.appendChild(r)}if(this.settings.hasCheckbox){const r=i.createElement("input");r.id=`${this.treeName}-${t.nodeId}-check`,r.type="checkbox",r.classList.add("checkbox"),r.dataset.id=t.nodeId,r.checked=this._checkedNodes.has(t.nodeId),this._checkColorClass!==""&&r.classList.add(this._checkColorClass),this._activeColor!==""&&r.classList.add(this._activeColor),this._activeBorderColor!==""&&r.classList.add(this._activeBorderColor),this._checkSizeClass!==""&&r.classList.add(this._checkSizeClass),d.appendChild(r)}const a=i.createElement("input");a.id=`${this.treeName}-${t.nodeId}-input`,a.type="text",a.value=t.text,a.classList.add("input","input-ghost","hidden","w-full","xinput"),this._inputColorClass!==""&&a.classList.add(this._inputColorClass),this._inputSizeClass!==""&&a.classList.add(this._inputSizeClass),a.dataset.id=t.nodeId,d.appendChild(a);const h=i.createElement("span");h.id=`${this.treeName}-${t.nodeId}-text`,h.textContent=t.text,h.dataset.id=t.nodeId,h.classList.add("xspan"),d.appendChild(h),n.appendChild(d)}e.appendChild(n)}}_onClick(e){const s=e.target.closest(".checkbox");if(s){e.stopPropagation();const d=this._normalizeId(s.dataset.id);if(this.nodeExists(d)){const o=s.checked;this._onCheckboxChange(d,o)}return}const i=e.target.closest(".xsummary");if(i){e.stopPropagation();const d=this._normalizeId(i.dataset.id);if(!this.nodeExists(d))return;const o=this.findNode(d);let h=this._getElementById(`${this.treeName}-${d}-details`).hasAttribute("open");h=!h,o.expanded=h;const r=h?"nodeExpanded":"nodeCollapsed",c=this._getElementById(`${this.treeName}-${d}-expandicon`);c&&(h?c.setAttribute("data-src",this.settings.expandIconUrl):c.setAttribute("data-src",this.settings.collapseIconUrl)),this._dispatchEvent(r,{node:o});return}const t=e.target.closest(".xspan");if(t){e.stopPropagation();const d=this._normalizeId(t.dataset.id);if(!this.nodeExists(d))return;const o=this.findNode(d);if(this.settings.inlineEdit&&e.target.id===`${this.treeName}-${d}-text`){this._enableInlineEdit(d);return}this._dispatchEvent("nodeClick",{node:o});return}const n=e.target.closest(".xanchor");if(n){e.stopPropagation();const d=this._normalizeId(n.dataset.id);if(!this.nodeExists(d))return;const o=this.findNode(d);if(this.settings.inlineEdit){this._enableInlineEdit(d);return}this._dispatchEvent("nodeClick",{node:o});return}}_enableDragAndDrop(){this.element.addEventListener("dragend",e=>{const s=this.element.querySelector(".drag-over");s&&s.classList.remove("drag-over")}),this.element.addEventListener("dragstart",e=>{const s=e.target.closest(".list-item");s&&e.dataTransfer.setData("id",s.dataset.id)}),this.element.addEventListener("dragover",e=>{e.preventDefault();const s=e.target.closest(".list-item");s&&s.classList.add("drag-over")}),this.element.addEventListener("dragleave",e=>{const s=e.target.closest(".list-item");s&&s.classList.remove("drag-over")}),this.element.addEventListener("drop",e=>{e.preventDefault();const s=e.target.closest(".list-item");if(!s)return;const i=e.dataTransfer.getData("id"),t=s.dataset.id;if(i===t)return;const n=this.findNode(i),d=this.findNode(t);let o=d;for(;o;){if(o.nodeId===i)return;o=this.findNode(o.parentId)}n&&d&&(this._dispatchEvent("nodeDragStart",{draggedNode:n}),this._dispatchEvent("nodeDrop",{draggedNode:n,targetNode:d}),this.removeNode(i),this.addNode(t,n.nodeId,n.iconUrl,n.text,n.href,n.hasCheckbox),this._refresh())})}_normalizeId(e){return(e??"").toString().trim().toLowerCase()}_cstr(e){return(e??"").toString()}nodeExists(e){const s=this._normalizeId(e);return s===""?!1:this.nodeMap.has(s)}findNode(e){const s=this._normalizeId(e);return s===""?null:this.nodeMap.get(s)||null}addNode(e,s,i="",t,n=""){if(e=this._normalizeId(e),s=this._normalizeId(s),i=this._cstr(i),t=this._cstr(t),n=this._cstr(n),s===""||this.nodeExists(s))return;i===""&&(i=this.settings.blankIconUrl);const d=this.settings.hasCheckbox||!1,o={nodeId:s,parentId:e,iconUrl:i,text:t,href:n,hasCheckbox:d};if(e==="")this.tree.push(o);else{const a=this.findNode(e);a&&(a.nodes=a.nodes||[],a.nodes.push(o),this.nodeMap.set(e,a))}this.nodeMap.set(s,o),this._visibleNodes.add(s)}addNodeBefore(e,s,i="",t,n=""){if(e=this._normalizeId(e),s=this._normalizeId(s),i=this._cstr(i),t=this._cstr(t),n=this._cstr(n),!this.nodeExists(e)||this.nodeExists(s))return;i===""&&(i=this.settings.blankIconUrl);const o=this.findNode(e).parentId,a={nodeId:s,parentId:o,iconUrl:i,text:t,href:n,hasCheckbox:this.settings.hasCheckbox||!1};if(o){const h=this.findNode(o);if(h&&h.nodes){const r=h.nodes.findIndex(c=>c.nodeId===e);r!==-1&&h.nodes.splice(r,0,a)}}else{const h=this.tree.findIndex(r=>r.nodeId===e);h!==-1&&this.tree.splice(h,0,a)}this.nodeMap.set(s,a),this._visibleNodes.add(s),this._refresh()}addNodeAfter(e,s,i="",t,n=""){if(e=this._normalizeId(e),s=this._normalizeId(s),i=this._cstr(i),t=this._cstr(t),n=this._cstr(n),!this.nodeExists(e)||this.nodeExists(s))return;i===""&&(i=this.settings.blankIconUrl);const o=this.findNode(e).parentId,a={nodeId:s,parentId:o,iconUrl:i,text:t,href:n,hasCheckbox:this.settings.hasCheckbox||!1};if(o){const h=this.findNode(o);if(h&&h.nodes){const r=h.nodes.findIndex(c=>c.nodeId===e);r!==-1&&h.nodes.splice(r+1,0,a)}}else{const h=this.tree.findIndex(r=>r.nodeId===e);h!==-1&&this.tree.splice(h+1,0,a)}this.nodeMap.set(s,a),this._visibleNodes.add(s),this._refresh()}findNodeRecursive(e,s){for(const i of e){if(i.nodeId===s)return i;if(i.nodes&&i.nodes.length>0){const t=findNodeRecursive(i.nodes,s);if(t)return t}}return null}hideNode(e){if(!this.nodeExists(e))return;const s=this.findNode(e),i=t=>{if(!t)return;this._visibleNodes.delete(t.nodeId),t.visible=!1;const n=this._getElementById(`${this.treeName}-${t.nodeId}`);n&&this._toggleVisibility(n,!1),t.nodes&&t.nodes.forEach(d=>i(d))};i(s)}showNode(e){if(!this.nodeExists(e))return;const s=this.findNode(e),i=t=>{if(!t)return;this._visibleNodes.add(t.nodeId),t.visible=!0;const n=this._getElementById(`${this.treeName}-${t.nodeId}`);n&&this._toggleVisibility(n,!0),t.nodes&&t.nodes.forEach(d=>i(d))};i(s)}checkNode(e,s){if(!this.nodeExists(e))return;const i=this.findNode(e),t=(n,d)=>{if(!n)return;d?this._checkedNodes.add(n.nodeId):this._checkedNodes.delete(n.nodeId),n.checked=d;const o=this._getElementById(`${this.treeName}-${n.nodeId}-check`);o&&(o.checked=d),n.nodes&&n.nodes.forEach(a=>t(a,d))};t(i,s)}expandNode(e,s){s?this._expandNode(e):this._collapseNode(e)}removeNode(e){if(e=this._normalizeId(e),!this.nodeExists(e))return;const s=this.findNode(e);if(s.parentId){const t=this.findNode(s.parentId);t&&t.nodes&&(t.nodes=t.nodes.filter(n=>n.nodeId!==e))}else this.tree=this.tree.filter(t=>t.nodeId!==e);this.nodeMap.delete(e);const i=this._getElementById(`${this.treeName}-${e}`);i&&i.remove(),this._visibleNodes.delete(e),this._selectedNodes.delete(e),this._checkedNodes.delete(e)}removeNodeRecursive(e){if(e=this._normalizeId(e),!this.nodeExists(e))return;const s=this.findNode(e);if(!s)return;if(Array.isArray(s.nodes))for(const t of[...s.nodes])t&&t.nodeId&&this.removeNodeRecursive(t.nodeId);if(s.parentId){const t=this.findNode(s.parentId);t&&t.nodes&&(t.nodes=t.nodes.filter(n=>n.nodeId!==e))}else this.tree=this.tree.filter(t=>t.nodeId!==e);this.nodeMap.delete(e);const i=this._getElementById(`${this.treeName}-${e}`);i&&i.remove(),this._visibleNodes.delete(e),this._selectedNodes.delete(e),this._checkedNodes.delete(e)}_expandNode(e){if(!this.nodeExists(e))return;const s=this.findNode(e);s.expanded=!0;const i=this._getElementById(`${this.treeName}-${s.nodeId}-details`);i&&i.setAttribute("open","")}_collapseNode(e){if(!this.nodeExists(e))return;const s=this.findNode(e);s.expanded=!1;const i=this._getElementById(`${this.treeName}-${s.nodeId}-details`);i&&i.removeAttribute("open")}enableNode(e,s){s?this._enableNode(e):this._disableNode(e)}_enableNode(e){if(!this.nodeExists(e))return;const s=this.findNode(e),i=t=>{if(!t)return;t.disabled=!1;const n=this._getElementById(`${this.treeName}-${t.nodeId}`);n&&n.classList.remove("menu-disabled"),t.nodes&&t.nodes.forEach(d=>i(d))};i(s)}_disableNode(e){if(!this.nodeExists(e))return;const s=this.findNode(e),i=t=>{if(!t)return;t.disabled=!0;const n=this._getElementById(`${this.treeName}-${t.nodeId}`);n&&n.classList.add("menu-disabled"),t.nodes&&t.nodes.forEach(d=>i(d))};i(s)}clear(){this.nodeMap.clear(),this.tree=[],this._checkedNodes.clear(),this._selectedNodes.clear(),this._visibleNodes.clear()}getChildren(e){if(!this.nodeExists(e))return[];const s=this.findNode(e);return Array.isArray(s.nodes)?[...s.nodes]:[]}getChildrenRecursive(e){if(!this.nodeExists(e))return[];const s=this.findNode(e);if(!s||!Array.isArray(s.nodes)||s.nodes.length===0)return[];const i=[],t=[...s.nodes].reverse(),n=new Set;for(;t.length;){const d=t.pop();if(!(!d||!d.nodeId)&&!n.has(d.nodeId)&&(n.add(d.nodeId),i.push(d),Array.isArray(d.nodes)&&d.nodes.length))for(let o=d.nodes.length-1;o>=0;o--)t.push(d.nodes[o])}return i}removeChildren(e){if(!this.nodeExists(e))return;const s=this.findNode(e);if(!(!s.nodes||s.nodes.length===0)){for(const i of[...s.nodes])i&&i.nodeId&&this.removeNodeRecursive(i.nodeId);s.nodes=[]}}updateNode(e,s,i,t=""){if(e=this._normalizeId(e),s=this._cstr(s),i=this._cstr(i),t=this._cstr(t),e===""||!this.nodeExists(e))return;s===""&&(s=this.settings.blankIconUrl);const n=this.findNode(e);n.iconUrl=s,n.text=i,n.href=t;const d=this._getElementById(`${this.treeName}-${n.nodeId}-text`);d&&(d.textContent=i);const o=this._getElementById(`${this.treeName}-${n.nodeId}-input`);o&&(o.value=i);const a=this._getElementById(`${this.treeName}-${n.nodeId}-icon`);a&&(a.dataset.src=s)}selectNode(e,s){if(!this.nodeExists(e))return;const i=this.findNode(e),t=(n,d)=>{if(!n)return;d?this._selectedNodes.add(n.nodeId):this._selectedNodes.delete(n.nodeId),n.selected=d;const o=this._getElementById(`${this.treeName}-${n.nodeId}`);o&&(d?o.classList.add("menu-active"):o.classList.remove("menu-active")),n.nodes&&n.nodes.forEach(a=>t(a,d))};t(i,s)}clearSelected(){this._selectedNodes.forEach(e=>this.selectNode(e.nodeId,!1)),this._selectedNodes.clear()}clearChecked(){this._checkedNodes.forEach(e=>this.checkNode(e.nodeId,!1)),this._checkedNodes.clear()}selectNodes(e){this._selectedNodes.forEach(i=>this.selectNode(i.nodeId,!1)),new Set(e.map(i=>this._normalizeId(i))).forEach(i=>this.selectNode(i,!0))}getSelectedNode(e=!1){const s=this.element.querySelector(".menu-active");if(!s)return null;const i=this._normalizeId(s.dataset.id),t=this.findNode(i);return!t||!e?t:{...t,nodes:t.nodes??[]}}getSelectedNodes(){return Array.from(this._selectedNodes)}getCheckedNodes(){return Array.from(this._checkedNodes)}checkNodes(e){this._checkedNodes.forEach(i=>this.checkNode(i.nodeId,!1));const s=new Set(e.map(i=>this._normalizeId(i)));s.forEach(i=>this.checkNode(i,!0)),this._dispatchEvent("nodesChecked",{nodeIds:s})}enableInlineEditing(e){this._enableInlineEdit(e)}refresh(){this._refresh()}nodeMoveLeft(e){if(!this.nodeExists(e))return;const s=this.findNode(e),i=this.findNode(s.parentId);if(i){if(s.parentId=i.parentId,i.nodes&&(i.nodes=i.nodes.filter(t=>t.nodeId!==e)),s.parentId){const t=this.findNode(s.parentId);t&&(t.nodes=t.nodes||[],t.nodes.push(s))}else this.tree.push(s);this._refresh()}}nodeMoveRight(e){if(!this.nodeExists(e))return;const s=this.findNode(e),i=this.findNode(s.parentId);if(i&&i.nodes){const t=i.nodes.findIndex(n=>n.nodeId===e);if(t>0){const n=i.nodes[t-1];n.nodes=n.nodes||[],n.nodes.push(s),s.parentId=n.nodeId,i.nodes.splice(t,1),this._refresh()}else console.warn("Cannot move the first child node to the right.")}else if(s.parentId)console.warn("Cannot move node to the right as it has no valid parent or sibling.");else{const t=this.tree.findIndex(n=>n.nodeId===e);if(t>0){const n=this.tree[t-1];n.nodes=n.nodes||[],n.nodes.push(s),s.parentId=n.nodeId,this.tree.splice(t,1),this._refresh()}else console.warn("Cannot move the first root node to the right.")}}nodeMoveUp(e){if(!this.nodeExists(e))return;const s=this.findNode(e),i=this.findNode(s.parentId);if(i&&i.nodes){const t=i.nodes.findIndex(n=>n.nodeId===e);t>0&&([i.nodes[t-1],i.nodes[t]]=[i.nodes[t],i.nodes[t-1]],this._refresh())}else if(!s.parentId){const t=this.tree.findIndex(n=>n.nodeId===e);t>0&&([this.tree[t-1],this.tree[t]]=[this.tree[t],this.tree[t-1]],this._refresh())}}nodeMoveDown(e){if(!this.nodeExists(e))return;const s=this.findNode(e),i=this.findNode(s.parentId);if(i&&i.nodes){const t=i.nodes.findIndex(n=>n.nodeId===e);t<i.nodes.length-1&&([i.nodes[t],i.nodes[t+1]]=[i.nodes[t+1],i.nodes[t]],this._refresh())}else if(!s.parentId){const t=this.tree.findIndex(n=>n.nodeId===e);t<this.tree.length-1&&([this.tree[t],this.tree[t+1]]=[this.tree[t+1],this.tree[t]],this._refresh())}}_dispatchEvent(e,s){const i=new CustomEvent(e,{detail:s});this.element.dispatchEvent(i)}_onBlur(e){const s=e.target.closest("input.xinput");if(!s)return;const i=this._normalizeId(s.dataset.id),t=this.findNode(i);if(!t)return;const n=this._getElementById(`${this.treeName}-${i}-text`);if(!n)return;const d=t.text;if(s.value.trim()===""){this._toggleVisibility(s,!1),this._toggleVisibility(n,!0),this._dispatchEvent("nodeEditCancelled",{node:t});return}if(s.value.trim()===d){this._toggleVisibility(s,!1),this._toggleVisibility(n,!0),this._dispatchEvent("nodeEditCancelled",{node:t});return}t.text=s.value.trim(),n.textContent=s.value.trim(),s.value=s.value.trim(),this._toggleVisibility(s,!1),this._toggleVisibility(n,!0),this._dispatchEvent("nodeEdited",{node:t})}_onKeydown(e){const s=e.target.closest("input.xinput");if(!s)return;const i=this._normalizeId(s.dataset.id),t=this.findNode(i);if(!t)return;const n=this._getElementById(`${this.treeName}-${i}-text`);if(!n)return;const d=t.text;e.key==="Enter"?s.blur():e.key==="Escape"&&(t.text=d,n.textContent=d,s.value=d,s.blur())}_enableInlineEdit(e){const s=this.findNode(e);if(!s)return;const i=this._getElementById(`${this.treeName}-${e}-text`),t=this._getElementById(`${this.treeName}-${e}-input`);!i||!t||(t.value=s.text,this._toggleVisibility(i,!1),this._toggleVisibility(t,!0),t.focus())}getTree(){return this.tree}flattenTree(){const e=s=>s.reduce((i,t)=>(i.push(t),t.nodes&&t.nodes.length>0&&(i=i.concat(e(t.nodes))),i),[]);return e(this.tree)}}return u});
